<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML to PPTX - Pixel Perfect</title>
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/5261/5261474.png">
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å html2canvas ‡πÄ‡∏õ‡πá‡∏ô html-to-image -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html-to-image/1.11.11/html-to-image.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/gitbrent/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>

    <!-- Font Preload -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@300;400;700&family=Kanit:wght@300;400;700&family=Mitr:wght@300;400&family=Prompt:wght@300;400;700&family=Sarabun:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
        body { background-color: #f8fafc; font-family: 'Prompt', sans-serif; height: 100vh; overflow: hidden; }
        
        .main-layout { display: grid; grid-template-columns: 350px 1fr; height: 100vh; }
        .editor-panel { background: white; border-right: 1px solid #e2e8f0; padding: 1rem; display: flex; flex-direction: column; overflow-y: auto; z-index: 10; }
        
        .preview-panel { background: #64748b; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 2rem; overflow: hidden; position: relative; }
        
        #preview-wrapper { width: 0; height: 0; position: relative; box-shadow: 0 20px 50px rgba(0,0,0,0.4); transition: all 0.3s ease; }
        #preview-frame { width: 1920px; height: 1080px; border: none; position: absolute; top: 0; left: 0; transform-origin: 0 0; background-color: white; }
        
        /* Loading Overlay */
        .loading-overlay {
            position: absolute; inset: 0; background: rgba(0,0,0,0.8);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 50; color: white; backdrop-filter: blur(5px);
        }
        
        /* Font Force Load Hack */
        #font-hack { position: absolute; opacity: 0; pointer-events: none; }
    </style>
</head>
<body>

    <!-- Hack: ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö Browser Render Font -->
    <div id="font-hack">
        <span style="font-family: 'Sarabun'">.</span>
        <span style="font-family: 'Kanit'">.</span>
        <span style="font-family: 'Prompt'">.</span>
        <span style="font-family: 'Mitr'">.</span>
    </div>

    <div class="main-layout">
        <div class="editor-panel">
            <h1 class="text-xl font-bold text-slate-800 mb-4">‚ö° Pixel Perfect Editor</h1>
            
            <div class="flex-1 flex flex-col mb-4">
                <label class="text-xs font-bold text-slate-500 mb-1">HTML CODE:</label>
                <textarea id="htmlInput" class="flex-1 w-full p-3 border border-slate-300 rounded bg-slate-50 font-mono text-xs outline-none resize-none"></textarea>
            </div>

            <div class="flex flex-col gap-3 pb-4 border-t border-slate-200 pt-4">
                <button onclick="updatePreview()" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 rounded text-sm">
                    üîÑ Refresh Preview
                </button>
                
                <div class="h-px bg-slate-200 my-1"></div>

                <div class="flex flex-col gap-1">
                    <label class="text-xs font-bold text-slate-400">STEP 1: Check Assets</label>
                    <button id="btn-preload" onclick="checkAssets()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 rounded text-sm transition flex items-center justify-center gap-2">
                        <span>üîç 1. Check Fonts & Images</span>
                    </button>
                </div>

                <div class="flex flex-col gap-1">
                    <label class="text-xs font-bold text-slate-400">STEP 2: Export</label>
                    <button id="btn-export" onclick="exportPPTX()" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 rounded text-sm transition shadow-lg opacity-50 cursor-not-allowed" disabled>
                        <span>üì• 2. Export PPTX</span>
                    </button>
                </div>
            </div>
        </div>

        <div class="preview-panel" id="previewPanel">
            <div class="absolute top-4 bg-white/90 px-3 py-1 rounded-full text-xs font-mono text-slate-800 shadow font-bold">
                1920 x 1080
            </div>
            <div id="preview-wrapper">
                <div id="loader" class="loading-overlay hidden">
                    <div class="animate-spin rounded-full h-10 w-10 border-4 border-white border-t-transparent mb-4"></div>
                    <span id="loader-text" class="text-lg font-bold">Processing...</span>
                </div>
                <iframe id="preview-frame"></iframe>
            </div>
        </div>
    </div>

    <script>
        const htmlInput = document.getElementById('htmlInput');
        const previewFrame = document.getElementById('preview-frame');
        const previewWrapper = document.getElementById('preview-wrapper');
        const previewPanel = document.getElementById('previewPanel');
        const loader = document.getElementById('loader');
        const loaderText = document.getElementById('loader-text');
        const btnPreload = document.getElementById('btn-preload');
        const btnExport = document.getElementById('btn-export');

        // Font Links
        const fontLinks = `<link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@300;400;700&family=Kanit:wght@300;400;700&family=Mitr:wght@300;400&family=Prompt:wght@300;400;700&family=Sarabun:wght@300;400;700&display=swap" rel="stylesheet">`;

        // 1. Resize Preview Area
        function resizePreview() {
            const scale = Math.min((previewPanel.clientWidth - 80) / 1920, (previewPanel.clientHeight - 80) / 1080);
            previewWrapper.style.width = `${1920 * scale}px`;
            previewWrapper.style.height = `${1080 * scale}px`;
            previewFrame.style.transform = `scale(${scale})`;
        }
        window.addEventListener('resize', resizePreview);

        // 2. Update Content
        function updatePreview() {
            resetButtons();
            let content = htmlInput.value;
            
            // Standardize Head
            const head = `
                <script src="https://cdn.tailwindcss.com"><\/script>
                ${fontLinks}
                <style>
                    body { margin: 0; width: 1920px; height: 1080px; overflow: hidden; background: white; -webkit-font-smoothing: antialiased; }
                    /* Fix for some layout issues */
                    * { box-sizing: border-box; }
                </style>
            `;
            
            if (!content.includes('cdn.tailwindcss.com')) {
                content = head + content;
            } else {
                content = `${fontLinks}<style>body{margin:0;width:1920px;height:1080px;overflow:hidden;}</style>` + content;
            }

            const doc = previewFrame.contentWindow.document;
            doc.open();
            doc.write(content);
            doc.close();
        }

        // 3. Reset Button State
        function resetButtons() {
            btnExport.disabled = true;
            btnExport.classList.add('opacity-50', 'cursor-not-allowed');
            btnPreload.innerText = "üîç 1. Check Fonts & Images";
            btnPreload.classList.remove('bg-green-600', 'hover:bg-green-700');
            btnPreload.classList.add('bg-blue-600', 'hover:bg-blue-700');
        }

        // 4. STEP 1: Check Assets (Fonts & Images)
        async function checkAssets() {
            btnPreload.innerText = "‚è≥ Checking...";
            const iframeDoc = previewFrame.contentWindow.document;

            // Wait for Fonts
            await document.fonts.ready; // Main window
            await iframeDoc.fonts.ready; // Iframe

            // Wait for Images
            const images = Array.from(iframeDoc.images);
            await Promise.all(images.map(img => {
                if (img.complete) return Promise.resolve();
                return new Promise(resolve => { img.onload = resolve; img.onerror = resolve; });
            }));

            // Success
            btnPreload.innerText = "‚úÖ Ready to Export";
            btnPreload.classList.remove('bg-blue-600', 'hover:bg-blue-700');
            btnPreload.classList.add('bg-green-600', 'hover:bg-green-700');
            
            btnExport.disabled = false;
            btnExport.classList.remove('opacity-50', 'cursor-not-allowed');
        }

        // 5. STEP 2: Export with html-to-image (Better than html2canvas)
        async function exportPPTX() {
            loader.classList.remove('hidden');
            loaderText.innerText = "High-Fidelity Rendering...";

            try {
                const iframeBody = previewFrame.contentWindow.document.body;

                // ‡πÉ‡∏ä‡πâ htmlToImage.toPng ‡∏ã‡∏∂‡πà‡∏á‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏Å‡∏ß‡πà‡∏≤ html2canvas ‡∏°‡∏≤‡∏Å
                // ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á Font Spacing ‡πÅ‡∏•‡∏∞ CSS Filter
                const dataUrl = await htmlToImage.toPng(iframeBody, {
                    quality: 1.0,
                    width: 1920,
                    height: 1080,
                    pixelRatio: 2, // 2x Scale for crisp text
                    backgroundColor: '#ffffff',
                    style: {
                        transform: 'none', // Reset transform to avoid offset
                        margin: 0
                    }
                });

                loaderText.innerText = "Creating PowerPoint...";

                // Create PPTX
                let pptx = new PptxGenJS();
                pptx.layout = 'LAYOUT_16x9';
                let slide = pptx.addSlide();
                
                // Add Image
                slide.addImage({ 
                    data: dataUrl, 
                    x: 0, 
                    y: 0, 
                    w: '100%', 
                    h: '100%' 
                });

                await pptx.writeFile({ fileName: 'PixelPerfect-Presentation.pptx' });

            } catch (error) {
                console.error(error);
                alert("Export Failed: " + error.message);
            } finally {
                loader.classList.add('hidden');
            }
        }

        // Initial Code
        htmlInput.value = `
<div class="w-full h-full relative overflow-hidden font-['Sarabun'] bg-slate-900">
    <!-- Complex Background -->
    <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-slate-800 via-slate-900 to-black"></div>
    <div class="absolute top-0 right-0 w-[800px] h-[800px] bg-blue-500/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/3"></div>
    
    <!-- Content Container -->
    <div class="relative z-10 w-full h-full flex flex-col items-center justify-center text-center p-16">
        
        <!-- Badge with Backdrop Filter (Test for accuracy) -->
        <div class="mb-8 px-6 py-2 bg-white/5 border border-white/10 rounded-full backdrop-blur-md shadow-xl">
            <span class="text-blue-300 font-bold tracking-widest uppercase text-sm">
                ‚ú® html-to-image Engine
            </span>
        </div>

        <!-- Main Heading with Gradient Text -->
        <h1 class="text-9xl font-black mb-6 text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 drop-shadow-2xl">
            Gemini HTML code to PPTX
        </h1>

        <p class="text-3xl text-slate-300 font-light max-w-4xl leading-relaxed mb-12">
            ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏≤‡πÉ‡∏ä‡πâ Engine ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ <b class="text-white font-bold">"‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û Browser"</b> ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á 
            ‡∏ó‡∏≥‡πÉ‡∏´‡πâ Font, ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á, ‡πÅ‡∏•‡∏∞ Effect ‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏õ‡πä‡∏∞‡πÜ
            <br>*** ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏ï‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ ‡πÉ‡∏ä‡πâ gimini ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö ***<br>
<font color="Orchid">"‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤ html ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô 1 ‡∏´‡∏ô‡πâ‡∏≤, ‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© 1920 x 1080 ‡πÅ‡∏ö‡∏ö Fixed-width website, ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ font sarabun ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô"</font>
        </p>

        <!-- Feature Grid -->
        <div class="grid grid-cols-3 gap-8 w-full max-w-5xl">
            <div class="bg-gradient-to-br from-white/10 to-white/5 p-8 rounded-2xl border border-white/10 text-left hover:scale-105 transition duration-500">
                <div class="text-4xl mb-4">üé®</div>
                <h3 class="text-2xl font-bold text-white mb-2 font-['Prompt']">Color & Gradient</h3>
                <p class="text-slate-400">‡∏™‡∏µ‡∏™‡∏±‡∏ô‡πÅ‡∏•‡∏∞ Gradient ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡πâ‡∏¢‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏≤‡∏á‡∏•‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö‡πÄ‡∏Å‡πà‡∏≤</p>
            </div>
            <div class="bg-gradient-to-br from-white/10 to-white/5 p-8 rounded-2xl border border-white/10 text-left hover:scale-105 transition duration-500">
                <div class="text-4xl mb-4">üî§</div>
                <h3 class="text-2xl font-bold text-white mb-2 font-['Kanit']">Font Spacing</h3>
                <p class="text-slate-400">‡∏ä‡πà‡∏≠‡∏á‡πÑ‡∏ü‡πÅ‡∏•‡∏∞‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏à‡∏∞‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡∏≤‡πÄ‡∏´‡πá‡∏ô 100%</p>
            </div>
            <div class="bg-gradient-to-br from-white/10 to-white/5 p-8 rounded-2xl border border-white/10 text-left hover:scale-105 transition duration-500">
                <div class="text-4xl mb-4">üíß</div>
                <h3 class="text-2xl font-bold text-white mb-2 font-['Mitr']">Complex CSS</h3>
                <p class="text-slate-400">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏≤ (Shadow) ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤</p>
            </div>
        </div>

    </div>
</div>`;
        
        resizePreview();
        updatePreview();
        
        // Auto-update
        let timer;
        htmlInput.addEventListener('keyup', () => {
            clearTimeout(timer);
            timer = setTimeout(updatePreview, 1000);
        });

    </script>
</body>
</html>
