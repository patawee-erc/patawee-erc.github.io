<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gachapon Lucky Draw</title>
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/8559/8559230.png">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;600;800&display=swap');

        :root {
            --primary: #ff6b6b;
            --secondary: #4ecdc4;
            --bg-color: #f7f1e3;
            --glass: rgba(255, 255, 255, 0.4);
            --shadow: rgba(0,0,0,0.15);
        }

        body {
            font-family: 'Kanit', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#d1ccc0 10%, transparent 10%);
            background-size: 20px 20px;
            height: 100vh;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            user-select: none;
        }

        /* --- CONFETTI CANVAS --- */
        #confetti-canvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 300;
        }

        /* --- WINNER LOG DRAWER (LEFT SIDE) --- */
        .winner-log-wrapper {
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
            z-index: 150;
            transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }
        
        .winner-log-wrapper.collapsed {
            transform: translateY(-50%) translateX(-300px); 
        }

        .winner-log-container {
            width: 250px;
            height: 500px;
            background: var(--glass);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: 0 25px 25px 0;
            padding: 20px;
            box-shadow: 10px 0 30px rgba(0,0,0,0.1);
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-left: none;
            display: flex;
            flex-direction: column;
        }

        .winner-log-container h3 {
            margin: 0 0 15px 0;
            color: var(--primary);
            font-weight: 800;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 2px solid rgba(255,107,107,0.1);
            padding-bottom: 10px;
        }

        #logList {
            list-style: none;
            padding: 0;
            margin: 0;
            overflow-y: auto;
            flex-grow: 1;
        }
        #logList::-webkit-scrollbar { width: 5px; }
        #logList::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 10px; }

        .log-item {
            background: rgba(255, 255, 255, 0.8);
            margin-bottom: 8px;
            padding: 10px 15px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            animation: slideIn 0.3s ease-out;
            border: 1px solid rgba(255,255,255,0.5);
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .log-num { font-weight: 800; color: #aaa; margin-right: 10px; font-size: 0.8rem; min-width: 20px; }
        .log-name { font-weight: 600; color: #333; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .log-dot { width: 12px; height: 12px; border-radius: 50%; margin-right: 12px; flex-shrink: 0; border: 2px solid #fff; }

        .toggle-log-btn {
            width: 40px;
            height: 100px;
            background: var(--glass);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-left: none;
            border-radius: 0 15px 15px 0;
            color: var(--primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            margin-left: -2px;
            box-shadow: 5px 0 15px rgba(0,0,0,0.05);
        }
        .toggle-log-btn:hover {
            width: 50px;
            background: rgba(255, 255, 255, 0.6);
        }

        /* --- GACHA MACHINE --- */
        .machine-wrapper { position: relative; transition: transform 0.1s; }
        .machine-wrapper.shaking { animation: shakeMachineAnim 0.4s ease-in-out; }
        @keyframes shakeMachineAnim {
            0% { transform: rotate(0deg); } 25% { transform: rotate(3deg); }
            50% { transform: rotate(-3deg); } 75% { transform: rotate(2deg); }
            100% { transform: rotate(0deg); }
        }

        .gacha-machine { width: 420px; display: flex; flex-direction: column; align-items: center; position: relative; z-index: 10; }

        .globe {
            width: 380px; height: 380px; background: var(--glass);
            border-radius: 50%; border: 10px solid rgba(255,255,255,0.6);
            box-shadow: inset 20px 20px 50px rgba(255,255,255,0.8), inset -20px -30px 50px rgba(0,0,0,0.1), 0 20px 40px rgba(0,0,0,0.2);
            position: relative; z-index: 2; overflow: hidden; backdrop-filter: blur(2px); cursor: pointer;
        }

        .balls-container { width: 100%; height: 100%; position: relative; }
        .dummy-ball { position: absolute; width: 65px; height: 65px; border-radius: 50%; box-shadow: inset -5px -5px 15px rgba(0,0,0,0.2); border: 3px solid rgba(0,0,0,0.1); }
        .shake .dummy-ball { animation: mixBalls 0.3s infinite; }
        @keyframes mixBalls {
            0% { transform: translate(0, 0); } 25% { transform: translate(15px, -20px); }
            50% { transform: translate(-15px, 10px); } 75% { transform: translate(10px, 20px); }
            100% { transform: translate(0, 0); }
        }

        .base {
            width: 420px; height: 320px; background: var(--primary);
            border-radius: 30px 30px 60px 60px; margin-top: -80px; position: relative; z-index: 1;
            box-shadow: inset 0 10px 20px rgba(0,0,0,0.2), 0 25px 50px rgba(0,0,0,0.3);
            display: flex; flex-direction: column; align-items: center; justify-content: flex-end; padding-bottom: 30px;
        }

        .plate { background: #fff; color: var(--primary); padding: 8px 30px; border-radius: 15px; font-weight: 800; font-size: 1.5rem; position: absolute; top: 90px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .knob-area { position: absolute; top: 150px; width: 130px; height: 130px; background: #fff; border-radius: 50%; box-shadow: 0 8px 15px rgba(0,0,0,0.2); display: flex; justify-content: center; align-items: center; z-index: 5; }
        .knob { width: 100px; height: 26px; background: #e0e0e0; border-radius: 12px; position: relative; cursor: pointer; transition: transform 0.5s ease; box-shadow: 0 6px 0 #bbb; }
        .knob::after { content: ''; position: absolute; top: -37px; left: 37px; width: 26px; height: 100px; background: #e0e0e0; border-radius: 12px; box-shadow: 6px 0 0 #bbb; }
        .knob.spinning { animation: rotateKnob 1s ease-in-out; }
        @keyframes rotateKnob { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .chute { width: 160px; height: 80px; background: #333; border-radius: 15px 15px 40px 40px; margin-bottom: 10px; position: relative; border: 4px solid #444; }
        
        .result-ball { width: 80px; height: 80px; border-radius: 50%; position: absolute; top: -150px; left: 40px; opacity: 0; transition: all 0.5s cubic-bezier(0.5, 1.6, 0.4, 0.7); z-index: 20; box-shadow: inset -8px -8px 15px rgba(0,0,0,0.3); }
        .result-ball.drop { top: 10px; opacity: 1; }

        /* --- UI ELEMENTS --- */
        .counter-badge { position: absolute; top: 20px; left: 20px; background: #fff; padding: 15px 30px; border-radius: 40px; font-weight: bold; color: #555; font-size: 1.2rem; box-shadow: 0 4px 10px rgba(0,0,0,0.1); z-index: 100; }
        .counter-badge span { color: var(--primary); font-size: 1.5rem; }

        .ui-panel { position: absolute; top: 20px; right: 20px; display: flex; flex-direction: column; gap: 10px; z-index: 100; }
        .circle-btn { width: 60px; height: 60px; border-radius: 50%; border: none; background: #fff; color: #555; font-size: 1.5rem; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: 0.2s; display: flex; justify-content: center; align-items: center; }
        .circle-btn:hover { transform: scale(1.1); color: var(--primary); }

        /* --- OVERLAY & MODAL --- */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); z-index: 600; display: flex; justify-content: center; align-items: center; opacity: 0; pointer-events: none; transition: 0.3s; }
        .modal.active { opacity: 1; pointer-events: all; }
        .modal-card { background: #fff; padding: 40px; border-radius: 20px; width: 90%; max-width: 500px; text-align: center; }
        textarea { width: 100%; height: 200px; padding: 15px; border: 2px solid #eee; border-radius: 10px; font-family: 'Kanit'; font-size: 1.1rem; margin: 20px 0; outline: none; }
        .btn-primary { background: var(--primary); color: #fff; border: none; padding: 12px 40px; border-radius: 50px; font-weight: bold; cursor: pointer; font-size: 1.2rem; }

        .winner-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 500;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: 0.3s;
        }
        .winner-overlay.active { opacity: 1; pointer-events: all; }

        .capsule-open { width: 350px; height: 350px; position: relative; margin-bottom: 50px; z-index: 10; }
        .capsule-half { width: 350px; height: 175px; position: absolute; transition: 0.6s cubic-bezier(0.23, 1, 0.32, 1); border: 6px solid rgba(0,0,0,0.1); }
        .top-half { top: 0; border-radius: 175px 175px 0 0; background: var(--primary); z-index: 2; }
        .bottom-half { bottom: 0; border-radius: 0 0 175px 175px; background: #fff; z-index: 1; }
        
        .winner-overlay.open .top-half { transform: translateY(-120px) rotate(-15deg); }
        .winner-overlay.open .bottom-half { transform: translateY(120px) rotate(10deg); }

        /* ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÄ‡∏™‡∏°‡∏≠ */
        .winner-name {
            font-size: 3.5rem; font-weight: 800; opacity: 0; transition: 0.5s; transition-delay: 0.4s;
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 90vw; /* ‡πÉ‡∏´‡πâ‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÅ‡∏ï‡πà‡πÄ‡∏ß‡πâ‡∏ô‡∏Ç‡∏≠‡∏ö‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢ */
            max-width: 1000px;
            text-align: center; color: #fff; text-shadow: 0 4px 15px rgba(0,0,0,0.5); z-index: 20;
            
            /* ‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß */
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis; 
        }
        .winner-overlay.open .winner-name { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }

        .close-winner-btn {
            position: relative;
            z-index: 100;
            background: #fff; color: var(--primary); border: none;
            padding: 15px 60px; border-radius: 50px; cursor: pointer;
            font-size: 1.6rem; font-weight: 800; box-shadow: 0 10px 25px rgba(0,0,0,0.4);
            transition: all 0.2s; margin-top: 40px;
        }
        .close-winner-btn:hover { transform: scale(1.1); background: #f0f0f0; }

    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>

    <div class="winner-log-wrapper" id="logWrapper">
        <div class="winner-log-container">
            <h3>üèÜ WINNERS</h3>
            <ul id="logList"></ul>
        </div>
        <button class="toggle-log-btn" onclick="toggleLog()">
            <span id="arrowIcon">‚ùÆ</span>
        </button>
    </div>

    <div class="counter-badge">‡πÄ‡∏´‡∏•‡∏∑‡∏≠ <span id="count">0</span> ‡∏•‡∏π‡∏Å</div>

    <div class="ui-panel">
        <button class="circle-btn" onclick="toggleSettings()" title="‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠">‚öôÔ∏è</button>
        <button class="circle-btn" id="soundBtn" onclick="toggleSound()" title="‡πÄ‡∏™‡∏µ‡∏¢‡∏á">üîä</button>
        <button class="circle-btn" style="color: #ff4757;" onclick="resetList()" title="‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï">‚Ü∫</button>
    </div>

    <div class="machine-wrapper" id="machineWrapper">
        <div class="gacha-machine">
            <div class="globe" onclick="shakeMachine()">
                <div class="balls-container" id="ballsContainer"></div>
            </div>
            <div class="base">
                <div class="plate">GASHAPON</div>
                <div class="knob-area">
                    <div class="knob" id="knob" onclick="spinGacha(event)"></div>
                </div>
                <div class="chute">
                    <div class="result-ball" id="resultBall"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="settingsModal">
        <div class="modal-card">
            <h2>‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ</h2>
            <textarea id="nameList" oninput="updateCount()">‡∏™‡∏°‡∏ä‡∏≤‡∏¢
‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á
‡∏õ‡∏£‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡πå
‡∏™‡∏∏‡∏î‡∏≤
‡∏°‡∏≤‡∏ô‡∏∞
‡∏õ‡∏¥‡∏ï‡∏¥
‡∏ß‡∏µ‡∏£‡∏∞
‡∏ä‡∏π‡πÉ‡∏à
‡πÄ‡∏Å‡πà‡∏á‡∏Å‡∏≤‡∏à
‡∏ß‡∏±‡∏ô‡πÄ‡∏û‡πá‡∏ç</textarea>
            <button class="btn-primary" onclick="toggleSettings()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å & ‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>

    <div class="winner-overlay" id="winnerOverlay">
        <div class="capsule-open">
            <div class="winner-name" id="winnerName">Winner</div>
            <div class="capsule-half top-half" id="capsuleTop"></div>
            <div class="capsule-half bottom-half"></div>
        </div>
        <button class="close-winner-btn" onclick="closeWinner()">‡πÑ‡∏õ‡∏ï‡πà‡∏≠</button>
    </div>

    <script>
        const nameInput = document.getElementById('nameList');
        const countSpan = document.getElementById('count');
        const settingsModal = document.getElementById('settingsModal');
        const ballsContainer = document.getElementById('ballsContainer');
        const knob = document.getElementById('knob');
        const resultBall = document.getElementById('resultBall');
        const winnerOverlay = document.getElementById('winnerOverlay');
        const capsuleTop = document.getElementById('capsuleTop');
        const winnerNameDiv = document.getElementById('winnerName');
        const soundBtn = document.getElementById('soundBtn');
        const machineWrapper = document.getElementById('machineWrapper');
        const logList = document.getElementById('logList');
        const logWrapper = document.getElementById('logWrapper');
        const arrowIcon = document.getElementById('arrowIcon');

        let namesArray = [];
        let originalNames = "";
        let isSpinning = false;
        let isMuted = false;
        let winnerHistory = [];
        
        const ballColors = ['#ff6b6b', '#4ecdc4', '#ffe66d', '#ff9ff3', '#54a0ff', '#ff9f43', '#00d2d3'];
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        window.onload = function() {
            originalNames = nameInput.value;
            updateCount();
            fillGlobeWithDummyBalls();
        };

        function toggleLog() {
            logWrapper.classList.toggle('collapsed');
            arrowIcon.innerText = logWrapper.classList.contains('collapsed') ? '‚ñ∂' : '‚ùÆ';
        }

        function fillGlobeWithDummyBalls() {
            ballsContainer.innerHTML = '';
            for(let i=0; i<25; i++) {
                const ball = document.createElement('div');
                ball.className = 'dummy-ball';
                ball.style.backgroundColor = ballColors[Math.floor(Math.random() * ballColors.length)];
                ball.style.left = (Math.random() * 280 + 20) + 'px';
                ball.style.top = (Math.random() * 150 + 150) + 'px'; 
                ball.style.transform = `rotate(${Math.random() * 360}deg)`;
                ballsContainer.appendChild(ball);
            }
        }

        function toggleSettings() { settingsModal.classList.toggle('active'); }
        function updateCount() {
            namesArray = nameInput.value.split('\n').map(n => n.trim()).filter(n => n !== "");
            countSpan.innerText = namesArray.length;
        }

        function toggleSound() {
            isMuted = !isMuted;
            soundBtn.innerText = isMuted ? "üîá" : "üîä";
            if(!isMuted && audioCtx.state === 'suspended') audioCtx.resume();
        }

        function playSound(freq, type, duration, vol) {
            if(isMuted) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.value = freq;
            gain.gain.value = vol;
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function shakeMachine() {
            if(isSpinning) return;
            if(audioCtx.state === 'suspended') audioCtx.resume();
            playSound(120, 'triangle', 0.1, 0.2);
            machineWrapper.classList.add('shaking');
            ballsContainer.classList.add('shake');
            setTimeout(() => {
                machineWrapper.classList.remove('shaking');
                ballsContainer.classList.remove('shake');
            }, 400);
        }

        function spinGacha(event) {
            if(event) event.stopPropagation();
            if(audioCtx.state === 'suspended') audioCtx.resume();
            namesArray = nameInput.value.split('\n').map(n => n.trim()).filter(n => n !== "");
            if(namesArray.length === 0) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ï‡∏¥‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏°‡∏∏‡∏ô!");
                toggleSettings();
                return;
            }
            if(isSpinning) return;
            
            isSpinning = true;
            knob.classList.add('spinning');
            playSound(150, 'square', 0.6, 0.1);
            ballsContainer.classList.add('shake'); 

            setTimeout(() => {
                knob.classList.remove('spinning');
                ballsContainer.classList.remove('shake');
                const winColor = ballColors[Math.floor(Math.random() * ballColors.length)];
                resultBall.style.backgroundColor = winColor;
                resultBall.classList.add('drop');
                setTimeout(() => { revealWinner(winColor); }, 600);
            }, 1000);
        }

        function revealWinner(color) {
            const winnerIdx = Math.floor(Math.random() * namesArray.length);
            const winner = namesArray[winnerIdx];
            capsuleTop.style.backgroundColor = color;
            winnerNameDiv.innerText = winner;
            winnerOverlay.classList.add('active');
            
            addToLog(winner, color);

            setTimeout(() => {
                playSound(500, 'sine', 0.4, 0.2);
                winnerOverlay.classList.add('open');
                fireConfetti();
            }, 150);

            namesArray.splice(winnerIdx, 1);
            nameInput.value = namesArray.join('\n');
            updateCount();
            resultBall.classList.remove('drop');
        }

        function addToLog(name, color) {
            winnerHistory.push({name, color});
            const li = document.createElement('li');
            li.className = 'log-item';
            li.innerHTML = `
                <span class="log-num">${winnerHistory.length}.</span>
                <div class="log-dot" style="background-color: ${color}"></div>
                <span class="log-name">${name}</span>
            `;
            logList.insertBefore(li, logList.firstChild);
        }

        function closeWinner() {
            winnerOverlay.classList.remove('active');
            winnerOverlay.classList.remove('open');
            isSpinning = false;
        }

        function resetList() {
            if(confirm("‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
                nameInput.value = originalNames;
                updateCount();
                winnerHistory = [];
                logList.innerHTML = '';
            }
        }

        function fireConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const pieces = [];
            const colors = ['#ff6b6b', '#4ecdc4', '#ffe66d', '#ff9ff3', '#54a0ff'];
            for (let i = 0; i < 150; i++) {
                pieces.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    size: Math.random() * 10 + 5,
                    speed: Math.random() * 6 + 4,
                    angle: Math.random() * 2 * Math.PI,
                    rotationSpeed: (Math.random() - 0.5) * 0.2
                });
            }
            function update() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                let active = 0;
                pieces.forEach(p => {
                    p.y += p.speed;
                    p.angle += p.rotationSpeed;
                    ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.angle);
                    ctx.fillStyle = p.color; ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size);
                    ctx.restore();
                    if (p.y < canvas.height) active++;
                });
                if (active > 0) requestAnimationFrame(update);
            }
            update();
        }
    </script>
</body>
</html>
