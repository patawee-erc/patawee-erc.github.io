<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MaiRoo LiveChat</title>
  <style>
    /* --- CSS ‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö --- */
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background-color: #e5ddd5; /* ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢ WhatsApp */ }
    
    /* ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° */
    #messages { 
      list-style-type: none; 
      margin: 0; 
      padding: 20px; 
      padding-bottom: 90px; /* ‡πÄ‡∏ß‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á */
      display: flex;
      flex-direction: column;
      height: 100vh;
      box-sizing: border-box;
      overflow-y: scroll; /* ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Å‡πà‡∏≤‡πÑ‡∏î‡πâ */
    }

    /* ‡πÅ‡∏ñ‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° */
    .message-row {
      display: flex;
      flex-direction: column;
      margin-bottom: 10px;
      max-width: 75%;
      position: relative;
    }

    /* ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏™‡πà‡∏á */
    .sender-name {
      font-size: 0.75rem;
      color: #555;
      margin-bottom: 2px;
      margin-left: 8px;
    }

    /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (Bubble) */
    .bubble {
      padding: 10px 14px;
      border-radius: 18px;
      font-size: 1rem;
      line-height: 1.4;
      box-shadow: 0 1px 1px rgba(0,0,0,0.1);
      word-wrap: break-word;
    }

    /* === ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô (‡∏ã‡πâ‡∏≤‡∏¢) === */
    .message-left { align-self: flex-start; }
    .message-left .bubble {
      background: #ffffff;
      color: #333;
      border-bottom-left-radius: 4px;
    }

    /* === ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏£‡∏≤ (‡∏Ç‡∏ß‡∏≤) === */
    .message-right { align-self: flex-end; align-items: flex-end; }
    .message-right .sender-name { display: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏≤‡πÄ‡∏≠‡∏á */ }
    .message-right .bubble {
      background: #dcf8c6; /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏≠‡πà‡∏≠‡∏ô */
      color: #333;
      border-bottom-right-radius: 4px;
    }

    /* ‡∏™‡πà‡∏ß‡∏ô‡∏•‡πà‡∏≤‡∏á: ‡∏ä‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏° */
    #form-container { 
      position: fixed; 
      bottom: 0; 
      left: 0; 
      right: 0; 
      background: #f0f0f0; 
      padding: 10px; 
      display: flex; 
      align-items: center;
      box-shadow: 0 -1px 5px rgba(0,0,0,0.1);
      z-index: 100;
    }

    /* ‡∏õ‡∏∏‡πà‡∏° Emoji */
    #emoji-btn {
      background: none; border: none; font-size: 1.6rem; cursor: pointer;
      padding: 0 10px; transition: transform 0.2s;
    }
    #emoji-btn:hover { transform: scale(1.2); }

    /* ‡∏ä‡πà‡∏≠‡∏á Input */
    input { 
      flex: 1; 
      padding: 12px 15px; 
      border: none; 
      border-radius: 25px; 
      outline: none;
      font-size: 1rem;
    }

    /* ‡∏õ‡∏∏‡πà‡∏°‡∏™‡πà‡∏á */
    #send-btn { 
      margin-left: 10px; 
      background: #128C7E; 
      color: white; 
      border: none; 
      border-radius: 50%; 
      width: 45px; height: 45px; 
      cursor: pointer; 
      font-weight: bold;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }
    #send-btn:hover { background: #075E54; }

    /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Emoji */
    #emoji-picker {
      position: fixed;
      bottom: 75px;
      left: 10px;
      background: white;
      border-radius: 10px;
      padding: 10px;
      width: 300px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      display: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô */
      flex-wrap: wrap;
      gap: 5px;
      z-index: 1000;
      max-height: 300px;
      overflow-y: auto;
    }
    .emoji-item {
      font-size: 1.5rem; padding: 5px; cursor: pointer; border-radius: 5px;
      user-select: none;
    }
    .emoji-item:hover { background-color: #eee; }

  </style>
</head>
<body>

  <!-- ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ä‡∏ó -->
  <div id="messages"></div>

  <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á Emoji (‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà) -->
  <div id="emoji-picker"></div>

  <!-- ‡πÅ‡∏ñ‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° -->
  <form id="form-container">
    <button type="button" id="emoji-btn">üòä</button>
    <input id="input" autocomplete="off" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°..." />
    <button type="submit" id="send-btn">‚û§</button>
  </form>

  <!-- ============================================ -->
  <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á Script ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô -->
  <!-- ============================================ -->
  
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <script>
    // -----------------------------------------------------------
    // 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å! ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ)
    // -----------------------------------------------------------
    const firebaseConfig = {
  apiKey: "AIzaSyCnX049F08ewwCLXOCa3NrKsG499Qce6bI",
  authDomain: "livechat-75751.firebaseapp.com",
  databaseURL: "https://livechat-75751-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "livechat-75751",
  storageBucket: "livechat-75751.firebasestorage.app",
  messagingSenderId: "314131503440",
  appId: "1:314131503440:web:53d6918b7645630bf5f455",
  measurementId: "G-MVP0BBDFQV"
};

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Firebase
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    var database = firebase.database();

    // -----------------------------------------------------------
    // 2. ‡∏£‡∏∞‡∏ö‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞ ID (‡∏™‡∏∏‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå+‡∏™‡∏µ)
    // -----------------------------------------------------------
    const animals = ["‡∏´‡∏°‡∏π", "‡πÅ‡∏°‡∏ß", "‡πÄ‡∏™‡∏∑‡∏≠", "‡πÑ‡∏Å‡πà", "‡πÄ‡∏õ‡πá‡∏î", "‡∏´‡∏°‡∏µ", "‡∏Å‡∏£‡∏∞‡∏ï‡πà‡∏≤‡∏¢", "‡∏ä‡πâ‡∏≤‡∏á", "‡∏•‡∏¥‡∏á", "‡∏´‡∏°‡∏≤"];
    const adjs = ["‡∏ã‡πà‡∏≤", "‡∏ó‡∏∞‡πÄ‡∏•", "‡∏≠‡∏ß‡∏Å‡∏≤‡∏®", "‡∏ö‡∏¥‡∏ô‡πÑ‡∏î‡πâ", "‡∏á‡πà‡∏ß‡∏á", "‡∏´‡∏¥‡∏ß", "‡∏à‡∏≠‡∏°‡∏ã‡∏ô", "‡∏≠‡∏¥‡∏ô‡∏î‡∏µ‡πâ", "‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å"];

    function getRandomName() {
      const animal = animals[Math.floor(Math.random() * animals.length)];
      const adj = adjs[Math.floor(Math.random() * adjs.length)];
      return animal + adj;
    }

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö localStorage ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏´‡∏°
    let myId = localStorage.getItem('chat_id');
    let myName = localStorage.getItem('chat_name');

    if (!myId) {
      myId = 'user_' + Date.now() + Math.random().toString(36).substr(2, 9);
      myName = getRandomName();
      localStorage.setItem('chat_id', myId);
      localStorage.setItem('chat_name', myName);
    }
    
    // ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏≤‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå
    document.getElementById('input').placeholder = `‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ "${myName}" ...`;

    // -----------------------------------------------------------
    // 3. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Emoji
    // -----------------------------------------------------------
    const emojiList = [
      "üòÄ","üòÇ","üòç","üòé","üò≠","üò°","üëç","üëé",
      "üôè","‚ù§Ô∏è","üíî","üéâ","üî•","‚ú®","üëÄ","üëª",
      "üê∑","üê∂","üê±","üêî","üåπ","‚òÄÔ∏è","üåô","‚≠ê",
      "‚úÖ","‚ùå","‚ùì","‚ùó","üçî","üç∫","‚öΩ","üéÆ"
    ];
    const emojiPicker = document.getElementById('emoji-picker');
    const emojiBtn = document.getElementById('emoji-btn');
    const inputField = document.getElementById('input');

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ Emoji
    emojiList.forEach(emoji => {
      let span = document.createElement('span');
      span.textContent = emoji;
      span.className = 'emoji-item';
      span.addEventListener('click', () => {
        inputField.value += emoji;
        inputField.focus();
      });
      emojiPicker.appendChild(span);
    });

    // ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î Emoji
    emojiBtn.addEventListener('click', (e) => {
      e.stopPropagation(); // ‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡∏ä‡∏ô event ‡∏Ñ‡∏•‡∏¥‡∏Å body
      emojiPicker.style.display = (emojiPicker.style.display === 'flex') ? 'none' : 'flex';
    });

    // ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏∑‡πà‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î Emoji
    document.body.addEventListener('click', (e) => {
      if (!emojiPicker.contains(e.target) && e.target !== emojiBtn) {
        emojiPicker.style.display = 'none';
      }
    });

    // -----------------------------------------------------------
    // 4. ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
    // -----------------------------------------------------------
    var form = document.getElementById('form-container');
    var messagesDiv = document.getElementById('messages');

    // [‡∏™‡πà‡∏á]
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      var msg = inputField.value.trim();

      if (msg) {
        // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏•‡∏±‡∏ö
        if (msg === '/‡∏•‡∏ö‡∏´‡∏°‡∏î') {
            if(confirm("‚ö†Ô∏è ‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏ä‡∏ó‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô?")) {
                database.ref('chats').remove();
            }
            inputField.value = '';
            return;
        }

        // ‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ Firebase
        database.ref('chats').push({
          message: msg,
          senderName: myName,
          senderId: myId,
          time: Date.now()
        });
        inputField.value = '';
        emojiPicker.style.display = 'none'; // ‡∏õ‡∏¥‡∏î emoji ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà
      }
    });

    // [‡∏£‡∏±‡∏ö] ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤
    database.ref('chats').on('child_added', function(snapshot) {
      var data = snapshot.val();
      createMessageBubble(data);
    });

    // [‡∏•‡πâ‡∏≤‡∏á‡∏à‡∏≠] ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏´‡∏°‡∏î
    database.ref('chats').on('value', function(snapshot) {
      if (!snapshot.exists()) {
        messagesDiv.innerHTML = '';
      }
    });

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á Bubble ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
    function createMessageBubble(data) {
      var row = document.createElement('div');
      var nameSpan = document.createElement('div');
      var bubble = document.createElement('div');

      nameSpan.textContent = data.senderName;
      nameSpan.className = 'sender-name';
      
      bubble.textContent = data.message;
      bubble.className = 'bubble';

      row.className = 'message-row';

      // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡πÉ‡∏Ñ‡∏£
      if (data.senderId === myId) {
        row.classList.add('message-right');
      } else {
        row.classList.add('message-left');
      }

      row.appendChild(nameSpan);
      row.appendChild(bubble);
      messagesDiv.appendChild(row);
      
      // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏•‡∏á‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
  </script>
</body>
</html>
