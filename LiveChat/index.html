<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Super Chat Online</title>
  <style>
    /* --- CSS ‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á --- */
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; background-color: #ece5dd; }

    /* ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° */
    #messages { 
      list-style-type: none; 
      margin: 0; 
      padding: 15px; 
      padding-bottom: 80px; /* ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡πÅ‡∏ñ‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå */
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      height: 100vh;
      box-sizing: border-box;
    }

    /* ‡πÅ‡∏ñ‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° */
    .message-row {
      display: flex;
      flex-direction: column;
      margin-bottom: 8px;
      max-width: 80%;
      position: relative;
    }

    /* ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏™‡πà‡∏á */
    .sender-name { font-size: 0.7rem; color: #777; margin-bottom: 2px; margin-left: 5px; }

    /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° */
    .bubble {
      padding: 8px 12px;
      border-radius: 12px;
      font-size: 0.95rem;
      line-height: 1.4;
      box-shadow: 0 1px 1px rgba(0,0,0,0.1);
      word-wrap: break-word;
    }

    /* ‡∏ù‡∏±‡πà‡∏á‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô (‡∏ã‡πâ‡∏≤‡∏¢) */
    .message-left { align-self: flex-start; }
    .message-left .bubble { background: #fff; color: #000; border-bottom-left-radius: 2px; }

    /* ‡∏ù‡∏±‡πà‡∏á‡πÄ‡∏£‡∏≤ (‡∏Ç‡∏ß‡∏≤) */
    .message-right { align-self: flex-end; align-items: flex-end; }
    .message-right .sender-name { display: none; } /* ‡∏ã‡πà‡∏≠‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏≤ */
    .message-right .bubble { background: #dcf8c6; color: #000; border-bottom-right-radius: 2px; }

    /* ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∞‡∏ö‡∏ö (System) */
    .message-system { align-self: center; max-width: 90%; margin: 10px 0; }
    .message-system .bubble { background: #ffeecd; color: #555; font-size: 0.8rem; text-align: center; border-radius: 20px; }
    .message-system .sender-name { display: none; }

    /* ‡πÅ‡∏ñ‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á */
    #form-container { 
      position: fixed; bottom: 0; left: 0; right: 0; 
      background: #f0f0f0; padding: 8px; display: flex; align-items: center;
      box-shadow: 0 -1px 3px rgba(0,0,0,0.1); z-index: 100;
    }

    input { 
      flex: 1; padding: 10px 15px; border: none; border-radius: 20px; 
      outline: none; font-size: 1rem; background: #fff;
    }

    button { border: none; background: none; cursor: pointer; }
    
    #emoji-btn { font-size: 1.5rem; padding: 0 10px; transition: transform 0.1s; }
    #emoji-btn:active { transform: scale(0.9); }

    #send-btn { 
      margin-left: 8px; background: #128C7E; color: white; 
      border-radius: 50%; width: 40px; height: 40px; 
      font-weight: bold; box-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }

    /* ‡∏Å‡∏•‡πà‡∏≠‡∏á Emoji */
    #emoji-picker {
      position: fixed; bottom: 70px; left: 10px; right: 10px; /* ‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠‡πÉ‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
      max-width: 350px; /* ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÉ‡∏ô‡∏à‡∏≠‡∏Ñ‡∏≠‡∏° */
      background: white; border-radius: 10px; padding: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2); display: none;
      flex-wrap: wrap; gap: 5px; z-index: 200;
      max-height: 250px; overflow-y: auto;
    }
    .emoji-item { font-size: 1.6rem; padding: 5px; cursor: pointer; user-select: none; }
    .emoji-item:hover { background-color: #f2f2f2; border-radius: 5px; }

  </style>
</head>
<body>

  <!-- ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ä‡∏ó -->
  <div id="messages"></div>

  <!-- Emoji Popup -->
  <div id="emoji-picker"></div>

  <!-- ‡πÅ‡∏ñ‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå -->
  <form id="form-container">
    <button type="button" id="emoji-btn">üòä</button>
    <input id="input" autocomplete="off" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°..." />
    <button type="submit" id="send-btn">‚û§</button>
  </form>

  <!-- FIREBASE SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <script>
    // ======================================================
    // 1. CONFIGURATION (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ!)
    // ======================================================
    var firebaseConfig = {
      apiKey: "‡πÉ‡∏™‡πà_API_KEY_‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì_‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà",
      authDomain: "xxxx.firebaseapp.com",
      databaseURL: "https://xxxx-default-rtdb.firebaseio.com", 
      projectId: "xxxx",
      storageBucket: "xxxx.appspot.com",
      messagingSenderId: "xxxx",
      appId: "xxxx"
    };

    // Initialize Firebase
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    var database = firebase.database();

    // ======================================================
    // 2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏£‡∏∞‡∏ö‡∏ö
    // ======================================================
    const animals = ["‡∏´‡∏°‡∏π", "‡πÅ‡∏°‡∏ß", "‡πÄ‡∏™‡∏∑‡∏≠", "‡πÑ‡∏Å‡πà", "‡πÄ‡∏õ‡πá‡∏î", "‡∏´‡∏°‡∏µ", "‡∏ï‡∏∏‡πà‡∏ô", "‡∏ä‡πâ‡∏≤‡∏á", "‡∏•‡∏¥‡∏á", "‡∏´‡∏°‡∏≤", "‡πÅ‡∏û‡∏ô‡∏î‡πâ‡∏≤"];
    const adjs = ["‡∏ã‡πà‡∏≤", "‡∏ô‡πâ‡∏≠‡∏¢", "‡πÉ‡∏´‡∏ç‡πà", "‡∏ö‡∏¥‡∏ô‡πÑ‡∏î‡πâ", "‡∏á‡πà‡∏ß‡∏á", "‡∏´‡∏¥‡∏ß", "‡∏à‡∏≠‡∏°‡∏û‡∏•‡∏±‡∏á", "‡∏≠‡∏¥‡∏ô‡∏î‡∏µ‡πâ", "‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å", "‡∏´‡∏±‡∏ß‡∏£‡πâ‡∏≠‡∏ô"];
    
    // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏´‡∏¢‡∏≤‡∏ö (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ)
    const badWords = ["‡∏Å‡∏π", "‡∏°‡∏∂‡∏á", "‡πÄ‡∏´‡∏µ‡πâ‡∏¢", "‡∏™‡∏±‡∏™", "‡∏Ñ‡∏ß‡∏¢", "‡πÄ‡∏¢‡πá‡∏î", "fuck", "shit", "hee", "tuy", "‡πÄ‡∏•‡∏ß"];

    // ======================================================
    // 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Utility (‡∏™‡∏∏‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠, ‡∏Å‡∏£‡∏≠‡∏á‡∏Ñ‡∏≥, Auto Clear)
    // ======================================================
    
    // ‡∏™‡∏∏‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠
    function getRandomName() {
      const animal = animals[Math.floor(Math.random() * animals.length)];
      const adj = adjs[Math.floor(Math.random() * adjs.length)];
      return animal + adj;
    }

    // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ñ‡∏≥‡∏´‡∏¢‡∏≤‡∏ö
    function censorText(text) {
      let cleanText = text;
      badWords.forEach(word => {
        let regex = new RegExp(word, "gi");
        cleanText = cleanText.replace(regex, "*".repeat(word.length));
      });
      return cleanText;
    }

    // Auto Delete: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö
    function autoClearChat() {
      var today = new Date().toLocaleDateString('th-TH');
      var dateRef = database.ref('system/lastClearDate');

      dateRef.once('value', function(snapshot) {
        var lastSavedDate = snapshot.val();
        if (lastSavedDate !== today) {
          console.log("New Day! Clearing chat...");
          database.ref('chats').remove(); // ‡∏•‡∏ö‡πÅ‡∏ä‡∏ó
          dateRef.set(today); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
          
          // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
          setTimeout(() => {
            database.ref('chats').push({
              message: "üßπ ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ß‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡πâ‡∏ß! ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÅ‡∏ä‡∏ó‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥",
              senderName: "System",
              senderId: "system_bot",
              time: Date.now()
            });
          }, 1000);
        }
      });
    }

    // ======================================================
    // 4. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (Main Logic)
    // ======================================================
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ï‡∏±‡∏ß‡∏ï‡∏ô (User Identity)
    let myId = localStorage.getItem('chat_id');
    let myName = localStorage.getItem('chat_name');

    if (!myId) {
      myId = 'user_' + Date.now() + Math.random().toString(36).substr(2, 9);
      myName = getRandomName();
      localStorage.setItem('chat_id', myId);
      localStorage.setItem('chat_name', myName);
    }
    
    document.getElementById('input').placeholder = `‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ "${myName}" ...`;

    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Auto Clear ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
    autoClearChat();

    // DOM Elements
    const form = document.getElementById('form-container');
    const inputField = document.getElementById('input');
    const messagesDiv = document.getElementById('messages');
    const emojiPicker = document.getElementById('emoji-picker');
    const emojiBtn = document.getElementById('emoji-btn');

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á Emoji
    const emojis = ["üòÄ","üòÇ","üòç","üòé","üò≠","üò°","üëç","üëé","üôè","‚ù§Ô∏è","üíî","üéâ","üî•","‚ú®","üëª","üê∑","üê∂","üê±","üêî","üåπ","‚òÄÔ∏è","‚úÖ","‚ùå","‚ùì"];
    emojis.forEach(char => {
      let span = document.createElement('span');
      span.textContent = char;
      span.className = 'emoji-item';
      span.onclick = () => {
        inputField.value += char;
        inputField.focus();
      };
      emojiPicker.appendChild(span);
    });

    // ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏¥‡∏î Emoji
    emojiBtn.onclick = (e) => {
      e.stopPropagation();
      emojiPicker.style.display = (emojiPicker.style.display === 'flex') ? 'none' : 'flex';
    };
    document.body.onclick = (e) => {
      if (!emojiPicker.contains(e.target) && e.target !== emojiBtn) emojiPicker.style.display = 'none';
    };

    // --- ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ---
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      var msg = inputField.value.trim();

      if (msg) {
        // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏•‡∏±‡∏ö
        if (msg === '/‡∏•‡∏ö‡πÉ‡∏´‡πâ‡∏´‡∏°‡∏î') {
          if (confirm("‚ö†Ô∏è ‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏ä‡∏ó‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) {
             database.ref('chats').remove();
          }
          inputField.value = '';
          return;
        }

        // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ñ‡∏≥‡∏´‡∏¢‡∏≤‡∏ö
        msg = censorText(msg);

        // ‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ Firebase
        database.ref('chats').push({
          message: msg,
          senderName: myName,
          senderId: myId,
          time: Date.now()
        });

        inputField.value = '';
        emojiPicker.style.display = 'none';
      }
    });

    // --- ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (Realtime) ---
    database.ref('chats').on('child_added', function(snapshot) {
      createMessageBubble(snapshot.val());
    });

    // --- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏•‡∏ö (‡∏•‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠) ---
    database.ref('chats').on('value', function(snapshot) {
      if (!snapshot.exists()) messagesDiv.innerHTML = '';
    });

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á Bubble
    function createMessageBubble(data) {
      var row = document.createElement('div');
      row.className = 'message-row';

      var nameSpan = document.createElement('div');
      nameSpan.className = 'sender-name';
      nameSpan.textContent = data.senderName;

      var bubble = document.createElement('div');
      bubble.className = 'bubble';
      bubble.textContent = data.message;

      // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏´‡∏ô
      if (data.senderId === 'system_bot') {
        row.classList.add('message-system');
      } else if (data.senderId === myId) {
        row.classList.add('message-right');
      } else {
        row.classList.add('message-left');
      }

      row.appendChild(nameSpan);
      row.appendChild(bubble);
      messagesDiv.appendChild(row);
      
      // Scroll ‡∏•‡∏á‡∏•‡πà‡∏≤‡∏á
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

  </script>
</body>
</html>
