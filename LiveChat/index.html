<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>MaiRoo LiveChat</title>
  <style>
    /* --- CSS Reset & Base --- */
    * { box-sizing: border-box; }
    
    body { 
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
      margin: 0; 
      background-color: #ece5dd; /* ‡πÉ‡∏ä‡πâ‡∏™‡∏µ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÅ‡∏ä‡∏ó‡πÄ‡∏•‡∏¢ */
      height: 100dvh; /* ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ */
      overflow: hidden;
      /* ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ */
    }

    /* --- ‡∏Å‡∏£‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ --- */
    #app-container {
      width: 100%;
      height: 100%;
      /* ‡∏•‡∏ö max-width ‡∏≠‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ PC */
      background-color: #ece5dd; 
      position: relative;
      display: flex;
      flex-direction: column;
    }

    /* --- ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° --- */
    #messages { 
      list-style-type: none; 
      margin: 0; 
      padding: 20px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏° Padding ‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÇ‡∏õ‡∏£‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏ô‡∏à‡∏≠‡πÉ‡∏´‡∏ç‡πà */
      padding-bottom: 80px; 
      flex: 1; 
      overflow-y: auto;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch; 
    }

    .message-row {
      display: flex;
      flex-direction: column;
      margin-bottom: 8px;
      max-width: 70%; /* ‡∏ö‡∏ô‡∏à‡∏≠ PC ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡∏à‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡∏¢‡∏≤‡∏Å (70%) */
      position: relative;
      animation: fadeIn 0.2s ease;
    }
    
    /* ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠: ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏´‡∏ô‡πà‡∏≠‡∏¢ */
    @media (max-width: 768px) {
      .message-row { max-width: 85%; }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .sender-name { font-size: 0.75rem; color: #666; margin-bottom: 4px; margin-left: 5px; }

    /* --- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° --- */
    .bubble {
      padding: 10px 16px; 
      border-radius: 18px;
      font-size: 1rem;
      line-height: 1.5;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
      word-wrap: break-word;
      word-break: break-word;
    }

    /* --- Emoji ‡∏•‡πâ‡∏ß‡∏ô --- */
    .bubble.only-emoji {
      background: none !important;
      box-shadow: none !important;
      font-size: 4rem; 
      padding: 0;
      line-height: 1.2;
    }

    /* ‡∏ù‡∏±‡πà‡∏á‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô (‡∏ã‡πâ‡∏≤‡∏¢) */
    .message-left { align-self: flex-start; }
    .message-left .bubble { background: #fff; color: #000; border-bottom-left-radius: 4px; }

    /* ‡∏ù‡∏±‡πà‡∏á‡πÄ‡∏£‡∏≤ (‡∏Ç‡∏ß‡∏≤) */
    .message-right { align-self: flex-end; align-items: flex-end; }
    .message-right .sender-name { display: none; } 
    .message-right .bubble { background: #dcf8c6; color: #000; border-bottom-right-radius: 4px; }

    /* --- ‡πÅ‡∏ñ‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á --- */
    #form-container { 
      position: absolute; 
      bottom: 0; left: 0; right: 0; 
      background: #f0f0f0; 
      padding: 10px 15px; 
      display: flex; 
      align-items: center;
      box-shadow: 0 -1px 3px rgba(0,0,0,0.05); 
      z-index: 100;
      padding-bottom: env(safe-area-inset-bottom, 10px); 
    }

    input { 
      flex: 1; 
      padding: 12px 20px; 
      border: none; 
      border-radius: 24px; 
      outline: none; 
      font-size: 16px; 
      background: #fff;
    }

    button { border: none; background: none; cursor: pointer; }
    
    #emoji-btn { font-size: 1.8rem; padding: 0 10px; transition: transform 0.1s; display: flex; align-items: center;}
    #emoji-btn:active { transform: scale(0.9); }

    #send-btn { 
      margin-left: 10px; 
      background: #128C7E; 
      color: white; 
      border-radius: 50%; 
      width: 46px; height: 46px; 
      display: flex; justify-content: center; align-items: center;
      font-weight: bold; 
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      font-size: 1.2rem;
      flex-shrink: 0;
    }

    /* --- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Emoji --- */
    #emoji-picker {
      position: absolute; 
      bottom: 80px; 
      left: 15px; 
      /* ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏î‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ PC ‡πÉ‡∏´‡πâ‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÅ‡∏Ñ‡πà‡∏û‡∏≠‡∏î‡∏µ */
      width: 100%;
      max-width: 350px; 
      background: white; 
      border-radius: 12px; 
      padding: 10px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2); 
      display: none;
      flex-wrap: wrap; 
      gap: 5px; 
      z-index: 200;
      justify-content: space-around;
      max-height: 40vh; 
      overflow-y: auto;
    }
    
    .emoji-item { 
      font-size: 2rem; 
      padding: 6px; 
      cursor: pointer; 
      user-select: none; 
      border-radius: 8px;
    }
    .emoji-item:hover { background-color: #f2f2f2; }

  </style>
</head>
<body>

  <div id="app-container">
    <div id="messages"></div>
    <div id="emoji-picker"></div>
    <form id="form-container">
      <button type="button" id="emoji-btn">üòä</button>
      <input id="input" autocomplete="off" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°..." enterkeyhint="send" />
      <button type="submit" id="send-btn">‚û§</button>
    </form>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <script>
    
    var firebaseConfig = {
      apiKey: "AIzaSyCnX049F08ewwCLXOCa3NrKsG499Qce6bI",
      authDomain: "livechat-75751.firebaseapp.com",
      databaseURL: "https://livechat-75751-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "livechat-75751",
      storageBucket: "livechat-75751.firebasestorage.app",
      messagingSenderId: "314131503440",
      appId: "1:314131503440:web:53d6918b7645630bf5f455",
      measurementId: "G-MVP0BBDFQV"
    };

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    var database = firebase.database();

    const animals = ["‡∏´‡∏°‡∏π", "‡πÅ‡∏°‡∏ß", "‡πÄ‡∏™‡∏∑‡∏≠", "‡πÑ‡∏Å‡πà", "‡πÄ‡∏õ‡πá‡∏î", "‡∏´‡∏°‡∏µ", "‡∏ï‡∏∏‡πà‡∏ô", "‡∏ä‡πâ‡∏≤‡∏á", "‡∏•‡∏¥‡∏á", "‡∏´‡∏°‡∏≤", "‡πÅ‡∏û‡∏ô‡∏î‡πâ‡∏≤"];
    const adjs = ["‡∏ã‡πà‡∏≤", "‡∏ï‡∏¥‡∏î‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÇ‡∏ö", "‡∏†‡∏π‡πÄ‡∏Ç‡∏≤", "‡∏ö‡∏¥‡∏ô‡πÑ‡∏î‡πâ", "‡∏á‡πà‡∏ß‡∏á", "‡∏´‡∏¥‡∏ß", "‡∏à‡∏≠‡∏°‡∏ã‡∏ô", "‡∏≠‡∏¥‡∏ô‡∏î‡∏µ‡πâ", "‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å", "‡∏´‡∏±‡∏ß‡∏£‡πâ‡∏≠‡∏ô"];
    const badWords = [ "‡πÄ‡∏´‡∏µ‡πâ‡∏¢", "‡∏™‡∏±‡∏™", "‡∏Ñ‡∏ß‡∏¢", "‡πÄ‡∏¢‡πá‡∏î", "‡∏´‡∏µ", "‡πÅ‡∏ï‡∏î", "hee", "kuy"];

    function getRandomName() {
      return animals[Math.floor(Math.random() * animals.length)] + adjs[Math.floor(Math.random() * adjs.length)];
    }

    function censorText(text) {
      let cleanText = text;
      badWords.forEach(word => {
        let regex = new RegExp(word, "gi");
        cleanText = cleanText.replace(regex, "*".repeat(word.length));
      });
      return cleanText;
    }

    function isEmojiOnly(str) {
       const check = str.replace(/\s/g, '');
       if (check.length === 0) return false;
       const hasText = /[a-zA-Z0-9‡∏Å-‡πô]/.test(check);
       return !hasText;
    }

    let myId = localStorage.getItem('chat_id');
    let myName = localStorage.getItem('chat_name');

    if (!myId) {
      myId = 'user_' + Date.now() + Math.random().toString(36).substr(2, 9);
      myName = getRandomName();
      localStorage.setItem('chat_id', myId);
      localStorage.setItem('chat_name', myName);
    }
    
    document.getElementById('input').placeholder = `‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ "${myName}" ...`;

    const form = document.getElementById('form-container');
    const inputField = document.getElementById('input');
    const messagesDiv = document.getElementById('messages');
    const emojiPicker = document.getElementById('emoji-picker');
    const emojiBtn = document.getElementById('emoji-btn');

    const emojis = ["üòÄ","üòÇ","üòç","üòé","üò≠","üò°","üëç","üëé","üôè","‚ù§Ô∏è","üíî","üéâ","üî•","‚ú®","üëª","üê∑","üê∂","üê±","üêî","üåπ","‚òÄÔ∏è","‚úÖ","‚ùå","‚ùì"];
    emojis.forEach(char => {
      let span = document.createElement('span');
      span.textContent = char;
      span.className = 'emoji-item';
      span.onclick = () => {
        inputField.value += char;
        inputField.focus(); 
      };
      emojiPicker.appendChild(span);
    });

    emojiBtn.onclick = (e) => {
      e.stopPropagation();
      emojiPicker.style.display = (emojiPicker.style.display === 'flex') ? 'none' : 'flex';
    };

    document.body.onclick = (e) => {
      if (!emojiPicker.contains(e.target) && e.target !== emojiBtn) emojiPicker.style.display = 'none';
    };

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      var msg = inputField.value.trim();

      if (msg) {
        if (msg === '/‡∏•‡∏ö‡∏´‡∏°‡∏î') {
          if (confirm("‚ö†Ô∏è ‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏ä‡∏ó‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) database.ref('chats').remove();
          inputField.value = '';
          return;
        }
        msg = censorText(msg);
        database.ref('chats').push({
          message: msg, senderName: myName, senderId: myId, time: Date.now()
        });
        inputField.value = '';
        emojiPicker.style.display = 'none';
        setTimeout(() => { messagesDiv.scrollTop = messagesDiv.scrollHeight; }, 100);
      }
    });

    database.ref('chats').on('child_added', function(snapshot) {
      createMessageBubble(snapshot.val());
    });

    database.ref('chats').on('value', function(snapshot) {
      if (!snapshot.exists()) messagesDiv.innerHTML = '';
    });

    function createMessageBubble(data) {
      var row = document.createElement('div');
      row.className = 'message-row';

      var nameSpan = document.createElement('div');
      nameSpan.className = 'sender-name';
      nameSpan.textContent = data.senderName;

      var bubble = document.createElement('div');
      bubble.className = 'bubble';
      bubble.textContent = data.message;

      if (isEmojiOnly(data.message)) bubble.classList.add('only-emoji');

      if (data.senderId === myId) row.classList.add('message-right');
      else row.classList.add('message-left');

      row.appendChild(nameSpan);
      row.appendChild(bubble);
      messagesDiv.appendChild(row);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
  </script>
</body>
</html>
