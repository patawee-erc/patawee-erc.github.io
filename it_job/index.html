<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Support Request</title>
    
    <!-- เหมือนเดิม: Bootstrap, FontAwesome, Google Fonts, SweetAlert2 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- CSS เดิม (ย่อไว้) -->
    <style>
      body { font-family: 'Prompt', sans-serif; background-color: #f0f2f5; min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px 0; }
      .card { border: none; border-radius: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); overflow: hidden; }
      .card-header { background: linear-gradient(135deg, #0d6efd, #0a58ca); color: white; text-align: center; padding: 20px; }
      .form-control, .form-select { border-radius: 10px; padding: 12px; background-color: #f8f9fa; border: 1px solid #dee2e6; }
      .btn-submit { background-color: #0d6efd; border: none; border-radius: 10px; padding: 12px; font-weight: 600; width: 100%; transition: all 0.3s; }
      .btn-submit:hover { background-color: #0b5ed7; transform: translateY(-2px); }
      .main-container { max-width: 500px; width: 100%; padding: 0 15px; }
    </style>
  </head>
  <body>

    <div class="main-container">
      <div class="card">
        <div class="card-header">
          <h3><i class="fas fa-headset me-2"></i>Support Job</h3>
          <p class="mb-0 small">บันทึกงานด้าน IT</p>
        </div>
        <div class="card-body p-4">
          
          <form id="itForm" onsubmit="handleFormSubmit(event)">
            
            <div class="mb-3">
              <label class="form-label text-muted small">ชื่อผู้แจ้ง</label>
              <input type="text" class="form-control" name="name" placeholder="ระบุชื่อของคุณ" required>
            </div>

            <div class="mb-3">
              <label class="form-label text-muted small">แผนก/ฝ่าย</label>
              <select class="form-select" name="department" required>
                <option value="" selected disabled>เลือกแผนก...</option>
                <option value="ผู้บริหารระดับสูง">ผู้บริหารระดับสูง</option>
                <option value="ฝ่ายกำกับการจัดหาและการควบคุมระบบไฟฟ้า (กฟ.)">ฝ่ายกำกับการจัดหาและการควบคุมระบบไฟฟ้า (กฟ.)</option>
                <option value="ฝ่ายกำกับอัตราค่าบริการพลังงาน (กอ.)">ฝ่ายกำกับอัตราค่าบริการพลังงาน (กอ.)</option>
                <option value="ฝ่ายกำกับการจัดหาและการควบคุมระบบก๊าซธรรมชาติ (กก.)">ฝ่ายกำกับการจัดหาและการควบคุมระบบก๊าซธรรมชาติ (กก.)</option>
                <option value="ฝ่ายนวัตกรรมและพัฒนาการกำกับกิจการพลังงาน (นพ.)">ฝ่ายนวัตกรรมและพัฒนาการกำกับกิจการพลังงาน (นพ.)</option>
                <option value="ฝ่ายอนุญาตการประกอบกิจการพลังงาน (อพ.)">ฝ่ายอนุญาตการประกอบกิจการพลังงาน (อพ.)</option>
                <option value="ฝ่ายสิ่งแวดล้อมและตรวจติดตามกิจการพลังงาน (ตพ.)">ฝ่ายสิ่งแวดล้อมและตรวจติดตามกิจการพลังงาน (ตพ.)</option>
                <option value="ฝ่ายกองทุนพัฒนาไฟฟ้า (ทฟ.)">ฝ่ายกองทุนพัฒนาไฟฟ้า (ทฟ.)</option>
                <option value="ฝ่ายส่งเสริมการมีส่วนร่วมและคุ้มครองสิทธิประโยชน์ (สค.)">ฝ่ายส่งเสริมการมีส่วนร่วมและคุ้มครองสิทธิประโยชน์ (สค.)</option>
                <option value="ฝ่ายกฎหมาย (กม.)">ฝ่ายกฎหมาย (กม.)</option>
                <option value="ฝ่ายคดี (คบ.)">ฝ่ายคดี (คบ.)</option>
                <option value="ฝ่ายจัดการที่ดินและทรัพย์สิน (จส.)">ฝ่ายจัดการที่ดินและทรัพย์สิน (จส.)</option>
                <option value="ฝ่ายบริหารงานองค์กร (บอ.)">ฝ่ายบริหารงานองค์กร (บอ.)</option>
                <option value="ฝ่ายยุทธศาสตร์และสื่อสารองค์กร (ยส.)">ฝ่ายยุทธศาสตร์และสื่อสารองค์กร (ยส.)</option>
                <option value="ฝ่ายเทคโนโลยีสารสนเทศและศูนย์ข้อมูลพลังงาน (ทศ.)">ฝ่ายเทคโนโลยีสารสนเทศและศูนย์ข้อมูลพลังงาน (ทศ.)</option>
                <option value="ฝ่ายบัญชีและการเงิน (บง.)">ฝ่ายบัญชีและการเงิน (บง.)</option>
                <option value="ฝ่ายบริหารทรัพยากรมนุษย์ (บม.)">ฝ่ายบริหารทรัพยากรมนุษย์ (บม.)</option>
                <option value="ฝ่ายอำนวยการคณะกรรมการ (อก.)">ฝ่ายอำนวยการคณะกรรมการ (อก.)</option>
                <option value="ฝ่ายตรวจสอบภายใน (ตส.)">ฝ่ายตรวจสอบภายใน (ตส.)</option>
                <option value="สำนักงาน กกพ. ประจำเขต 1 (เชียงใหม่) - สข.1">สำนักงาน กกพ. ประจำเขต 1 (เชียงใหม่) - สข.1</option>
                <option value="สำนักงาน กกพ. ประจำเขต 2 (พิษณุโลก) - สข.2">สำนักงาน กกพ. ประจำเขต 2 (พิษณุโลก) - สข.2</option>
                <option value="สำนักงาน กกพ. ประจำเขต 3 (นครสวรรค์) - สข.3">สำนักงาน กกพ. ประจำเขต 3 (นครสวรรค์) - สข.3</option>
                <option value="สำนักงาน กกพ. ประจำเขต 4 (ขอนแก่น) - สข.4">สำนักงาน กกพ. ประจำเขต 4 (ขอนแก่น) - สข.4</option>
                <option value="สำนักงาน กกพ. ประจำเขต 5 (อุบลราชธานี) - สข.5">สำนักงาน กกพ. ประจำเขต 5 (อุบลราชธานี) - สข.5</option>
                <option value="สำนักงาน กกพ. ประจำเขต 6 (นครราชสีมา) - สข.6">สำนักงาน กกพ. ประจำเขต 6 (นครราชสีมา) - สข.6</option>
                <option value="สำนักงาน กกพ. ประจำเขต 7 (สระบุรี) - สข.7">สำนักงาน กกพ. ประจำเขต 7 (สระบุรี) - สข.7</option>
                <option value="สำนักงาน กกพ. ประจำเขต 8 (ชลบุรี) - สข.8">สำนักงาน กกพ. ประจำเขต 8 (ชลบุรี) - สข.8</option>
                <option value="สำนักงาน กกพ. ประจำเขต 9 (กาญจนบุรี) - สข.9">สำนักงาน กกพ. ประจำเขต 9 (กาญจนบุรี) - สข.9</option>
                <option value="สำนักงาน กกพ. ประจำเขต 10 (ราชบุรี) - สข.10">สำนักงาน กกพ. ประจำเขต 10 (ราชบุรี) - สข.10</option>
                <option value="สำนักงาน กกพ. ประจำเขต 11 (สุราษฎร์ธานี) - สข.11">สำนักงาน กกพ. ประจำเขต 11 (สุราษฎร์ธานี) - สข.11</option>
                <option value="สำนักงาน กกพ. ประจำเขต 12 (สงขลา) - สข.12">สำนักงาน กกพ. ประจำเขต 12 (สงขลา) - สข.12</option>
                <option value="สำนักงาน กกพ. ประจำเขต 13 (กรุงเทพมหานคร) - สข.13">สำนักงาน กกพ. ประจำเขต 13 (กรุงเทพมหานคร) - สข.13</option>
              </select>
            </div>

            <div class="mb-3">
              <label class="form-label text-muted small">หมวดหมู่ปัญหา</label>
              <select class="form-select" name="category" required>
                <option value="" selected disabled>เลือกปัญหา...</option>
                <option value="Hardware">Hardware</option>
                <option value="Software">Software</option>
                <option value="Network">Network</option>
                <option value="knowledge">Knowledge</option>
                <option value="Meeting">Meeting</option>
                <option value="Server">Server</option>
              </select>
            </div>

            <div class="mb-4">
              <label class="form-label text-muted small">รายละเอียด</label>
              <textarea class="form-control" name="detail" rows="3" required></textarea>
            </div>

            <button type="submit" class="btn btn-primary btn-submit text-white" id="btnSubmit">
              <i class="fas fa-paper-plane me-2"></i>ลงบันทึก
            </button>
          </form>

        </div>
      </div>
    </div>

    <script>
      // ******************************************************
      // ใส่ URL ของ Google Apps Script Web App ที่ Deploy แล้ว ตรงนี้
      const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwLbvPvAP-ei8S1sT7ULQB_7hUt5AeeESTAStlDgE3TusTOOSYpOSXVJVNgEW2YM0bX/exec'; 
      // ******************************************************

      function handleFormSubmit(e) {
        e.preventDefault();
        
        var btn = document.getElementById('btnSubmit');
        var originalBtnText = btn.innerHTML;
        
        btn.disabled = true;
        btn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> กำลังบันทึก...';

        var formObject = {
          name: document.getElementsByName('name')[0].value,
          department: document.getElementsByName('department')[0].value,
          category: document.getElementsByName('category')[0].value,
          detail: document.getElementsByName('detail')[0].value
        };

        // ใช้ fetch API ยิงข้อมูลไปหา Google Script
        fetch(SCRIPT_URL, { 
          method: 'POST',
          // เทคนิคสำคัญ: ต้องส่งแบบ text/plain เพื่อหลบ CORS Policy ของ Google
          headers: { "Content-Type": "text/plain;charset=utf-8" },
          body: JSON.stringify(formObject)
        })
        .then(response => response.json()) // แปลงผลลัพธ์เป็น JSON
        .then(data => {
          if (data.result === 'success') {
            Swal.fire({
                icon: 'success',
                title: 'บันทึกสำเร็จ!',
                text: 'ได้รับข้อมูลเรียบร้อยแล้ว',
                confirmButtonColor: '#0d6efd'
            });
            document.getElementById('itForm').reset();
          } else {
            throw new Error(data.error);
          }
        })
        .catch(error => {
          console.error('Error:', error);
          Swal.fire('Error', 'เกิดข้อผิดพลาดในการเชื่อมต่อ', 'error');
        })
        .finally(() => {
          btn.disabled = false;
          btn.innerHTML = originalBtnText;
        });
      }
    </script>
  </body>
</html>
